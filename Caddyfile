:{$PORT:8080} {
    # Health endpoints without auth
    handle /health {
        respond "OK" 200
    }
    handle /healthz {
        respond "OK" 200
    }

    @authorized {
        header Authorization "Bearer {env.BEARER_TOKEN}"
    }

    handle @authorized {
        reverse_proxy localhost:8000 {
            header_up Host {upstream_hostport}
            header_up X-Forwarded-Host {host}
        }
    }

    handle {
        header WWW-Authenticate "Bearer"
        respond "Unauthorized" 401
    }

    log {
        output stdout
        format console
    }
}
